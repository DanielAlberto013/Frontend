<!-- src/app/features/reportes/reportes.component.html -->
<div class="reportes-container">
  <!-- HEADER CON BOTÓN DE REGRESO -->
  <div class="header">
    <div class="header-content">
      <button class="btn-regresar" (click)="regresarAlDashboard()">
        <i class="fas fa-arrow-left"></i>
        Regresar al Dashboard
      </button>
      <div class="header-info">
        <h1>
          <i class="fas fa-chart-bar"></i>
          <span *ngIf="authService.isAdmin() || authService.isRevisor()">Reportes de Proyectos Aprobados</span>
          <span *ngIf="authService.isDocente()">Mis Proyectos Aprobados</span>
        </h1>
        <p *ngIf="authService.isAdmin() || authService.isRevisor()">
          Lista completa de proyectos aprobados en el sistema
        </p>
        <p *ngIf="authService.isDocente()">
          Resumen de tus proyectos aprobados
        </p>
      </div>
    </div>
  </div>

  <!-- LOADING -->
  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Cargando datos...</p>
  </div>

  <!-- ERROR -->
  <div *ngIf="error && !loading" class="error">
    <i class="fas fa-exclamation-triangle"></i>
    <p>{{ error }}</p>
    <button class="btn-retry" (click)="cargarDatos()">Reintentar</button>
  </div>

  <!-- CONTENIDO PARA ADMIN/REVISOR -->
  <div *ngIf="(authService.isAdmin() || authService.isRevisor()) && !loading && !error" class="admin-content">
    
    <!-- BOTONES DE EXPORTACIÓN -->
    <div class="export-buttons">
      <button class="btn-excel" (click)="generarReporteExcel()" [disabled]="proyectosUnicos.length === 0">
        <i class="fas fa-file-excel"></i> Exportar a Excel
      </button>
      <button class="btn-pdf" (click)="generarReportePDF()" [disabled]="proyectosUnicos.length === 0">
        <i class="fas fa-file-pdf"></i> Exportar a PDF
      </button>
      <button class="btn-regresar-inline" (click)="regresarAlDashboard()">
        <i class="fas fa-home"></i> Dashboard
      </button>
    </div>

    <!-- RESUMEN GENERAL -->
    <div class="resumen-general">
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-folder-open"></i>
        </div>
        <div class="stat-info">
          <h3>{{ proyectosUnicos.length }}</h3>
          <p>Proyectos Aprobados</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-dollar-sign"></i>
        </div>
        <div class="stat-info">
          <h3>${{ getTotalGeneral().toLocaleString('es-MX', { minimumFractionDigits: 2 }) }}</h3>
          <p>Presupuesto Total</p>
        </div>
      </div>
    </div>

    <!-- LISTA DIRECTA DE PROYECTOS -->
    <div class="proyectos-lista">
      <div *ngFor="let proyecto of proyectosUnicos" class="proyecto-card-directo">
        <div class="proyecto-header-directo">
          <h3>{{ proyecto.proyectoNombre }}</h3>
          <span class="estado-badge aprobado">Aprobado</span>
        </div>
        
        <div class="proyecto-info-directo">
          <div class="info-grid">
            <div class="info-item">
              <strong>Docente:</strong>
              <span>{{ proyecto.docenteNombre }}</span>
            </div>
            <div class="info-item">
              <strong>Partida:</strong>
              <span>{{ proyecto.partidaCodigo }} - {{ proyecto.partidaNombre }}</span>
            </div>
            <div class="info-item">
              <strong>Presupuesto Total:</strong>
              <span class="monto">${{ proyecto.presupuestoTotal.toLocaleString('es-MX', { minimumFractionDigits: 2 }) }}</span>
            </div>
            <div class="info-item">
              <strong>Federal:</strong>
              <span class="monto">${{ proyecto.presupuestoFederal.toLocaleString('es-MX', { minimumFractionDigits: 2 }) }}</span>
            </div>
            <div class="info-item">
              <strong>Estatal:</strong>
              <span class="monto">${{ proyecto.presupuestoEstatal.toLocaleString('es-MX', { minimumFractionDigits: 2 }) }}</span>
            </div>
          </div>
        </div>
        
        <div class="proyecto-status-directo">
          <i class="fas fa-check-circle"></i>
          <span>Listo para realizar cotizaciones</span>
        </div>
      </div>

      <!-- SIN DATOS -->
      <div *ngIf="proyectosUnicos.length === 0" class="no-data">
        <i class="fas fa-inbox"></i>
        <h3>No hay proyectos aprobados</h3>
        <p>No se encontraron proyectos con estado APROBADO en el sistema</p>
      </div>
    </div>
  </div>

  <!-- CONTENIDO PARA DOCENTE -->
  <div *ngIf="authService.isDocente() && !loading && !error" class="docente-content">
    
    <!-- BOTONES DEL TICKET -->
    <div class="ticket-actions" *ngIf="ticketDocente">
      <button class="btn-pdf" (click)="generarTicketPDF()" [disabled]="ticketDocente.proyectos.length === 0">
        <i class="fas fa-download"></i> Descargar PDF
      </button>
      <button class="btn-print" (click)="imprimirTicket()" [disabled]="ticketDocente.proyectos.length === 0">
        <i class="fas fa-print"></i> Imprimir Ticket
      </button>
      <button class="btn-regresar-inline" (click)="regresarAlDashboard()">
        <i class="fas fa-home"></i> Dashboard
      </button>
    </div>

    <!-- TICKET DEL DOCENTE -->
    <div *ngIf="ticketDocente" class="ticket-container">
      <div class="ticket-header">
        <div class="ticket-logo">
          <i class="fas fa-file-alt"></i>
        </div>
        <div class="ticket-info">
          <h2>Mis Proyectos Aprobados</h2>
          <p>ITESCAM - Sistema de Finanzas</p>
        </div>
      </div>

      <div class="ticket-body">
        <!-- INFORMACIÓN DEL DOCENTE -->
        <div class="docente-info">
          <h3>{{ ticketDocente.docenteNombre }}</h3>
          <p>Fecha de generación: {{ ticketDocente.fechaGeneracion | date:'dd/MM/yyyy HH:mm' }}</p>
        </div>

        <!-- PROYECTOS APROBADOS -->
        <div *ngIf="ticketDocente.proyectos.length > 0" class="proyectos-ticket">
          <div *ngFor="let proyecto of ticketDocente.proyectos" class="proyecto-ticket">
            <div class="proyecto-header">
              <h4>{{ proyecto.nombre }}</h4>
              <span class="total">${{ proyecto.presupuestoTotal.toLocaleString('es-MX', { minimumFractionDigits: 2 }) }}</span>
            </div>
            
            <div class="proyecto-detalles">
              <p><strong>Descripción:</strong> {{ proyecto.descripcion }}</p>
              <p><strong>Edición:</strong> {{ proyecto.edicion }}</p>
              <p><strong>Presupuesto Federal:</strong> ${{ proyecto.presupuestoFederal.toLocaleString('es-MX', { minimumFractionDigits: 2 }) }}</p>
              <p><strong>Presupuesto Estatal:</strong> ${{ proyecto.presupuestoEstatal.toLocaleString('es-MX', { minimumFractionDigits: 2 }) }}</p>
            </div>
          </div>
        </div>

        <!-- TOTAL GENERAL -->
        <div class="ticket-total">
          <h3>Presupuesto Total Aprobado: ${{ ticketDocente.totalGeneral.toLocaleString('es-MX', { minimumFractionDigits: 2 }) }}</h3>
        </div>

        <!-- SIN PROYECTOS -->
        <div *ngIf="ticketDocente.proyectos.length === 0" class="no-proyectos">
          <i class="fas fa-folder-open"></i>
          <h4>No tienes proyectos aprobados</h4>
          <p>Los proyectos aparecerán aquí una vez que sean aprobados por el administrador</p>
        </div>
      </div>

      <div class="ticket-footer">
        <p>ITESCAM - Sistema de Gestión de Finanzas</p>
        <small>Este documento lista tus proyectos aprobados para gestión de recursos</small>
      </div>
    </div>
  </div>
</div>